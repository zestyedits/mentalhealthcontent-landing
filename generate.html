<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Generate — MentalHealthContent.ai</title>
  <meta name="description" content="Generate client-friendly mental-health content using ethical, evidence-informed AI." />

  <!-- Inter font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />

  <!-- DOCX generator (client-side) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.3.2/docx.umd.min.js" defer></script>

  <style>
    :root{
      /* Theme */
      --bg: #0a0f1f;
      --bg-2:#0c1226;
      --surface:#0f1733;
      --border:#1f2a4a;
      --ink:#eaf0ff;
      --muted:#bfc9ff;
      --brand-1:#8b5cf6; /* violet */
      --brand-2:#22d3ee; /* cyan   */
      --ok:#22c55e;
      --radius:18px;
      --shadow: 0 10px 28px rgba(11,17,35,.35);

      /* Layout metrics */
      --container: 1180px;
      --rail: 380px;
      --gap: 28px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--ink);
      background:
        radial-gradient(900px 600px at 50% -120px, rgba(139,92,246,.25), transparent 60%),
        linear-gradient(135deg, #0a0f1f, #0b1022 45%, #0a0f1f 100%);
    }
    a{color:inherit;text-decoration:none}

    /* Container stays perfectly centered and capped */
    .container{width:min(var(--container), 92%); margin:0 auto}

    /* Header (keep your existing nav structure) */
    header{position:sticky;top:0;z-index:50;backdrop-filter:saturate(120%) blur(10px)}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
    .brand{display:flex;align-items:center;gap:.6rem;font-weight:800;letter-spacing:.2px}
    .brand svg{width:26px;height:26px;flex:0 0 auto}
    .menu{display:flex;gap:.6rem;align-items:center}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:.4rem;
      padding:.5rem .9rem;border-radius:12px;border:1px solid transparent;
      font-weight:600;line-height:1;cursor:pointer;transition:transform .15s ease, box-shadow .15s ease, border-color .2s ease;
    }
    .btn:hover{transform:translateY(-2px)}
    .btn.primary{
      background: linear-gradient(135deg, var(--brand-1), var(--brand-2));
      color:#071018; box-shadow: 0 8px 22px rgba(167,139,250,.25), 0 4px 12px rgba(34,211,238,.18);
    }
    .btn.ghost{background:transparent;border-color:rgba(231,229,255,.1);color:var(--muted)}
    .btn.ghost:hover{border-color:rgba(231,229,255,.25)}

    .chip{
      display:inline-flex;align-items:center;gap:.45rem;
      font-size:.8rem;color:var(--muted);
      background:linear-gradient(180deg, rgba(139,92,246,.16), rgba(34,211,238,.08));
      padding:.35rem .6rem;border-radius:999px;border:1px solid rgba(231,229,255,.12)
    }
    .pill{
      background:rgba(34,211,238,.1);
      border:1px solid rgba(34,211,238,.3);
      color:#a5f3fc; padding:.35rem .55rem; border-radius:999px; font-weight:600; font-size:.8rem
    }
    .small{font-size:.92rem;color:var(--muted)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}

    /* Hero */
    .hero{padding:28px 0 8px}
    .hero h1{font-size:clamp(1.9rem, 1rem + 3vw, 2.5rem);margin:.2rem 0 .55rem;line-height:1.12}
    .hero p{color:var(--muted);max-width:780px;margin:.25rem 0 0}

    /* Studio layout: left rail + right canvas; perfectly centered */
    .studio{
      display:grid;
      grid-template-columns: 1fr;
      gap: var(--gap);
      margin: 22px 0 36px;
      align-items:start;
    }
    @media (min-width: 1024px){
      .studio{
        grid-template-columns: minmax(340px, var(--rail)) minmax(0, 1fr);
      }
    }

    .rail, .canvas{
      background: linear-gradient(180deg, rgba(16,22,54,.84), rgba(12,17,40,.88));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
    }
    .rail h3, .canvas h3{margin:0 0 10px}

    label{display:block;font-weight:600;margin:6px 0 6px}
    input, select, textarea{
      width:100%; background: #0b1028; color:var(--ink);
      border:1px solid var(--border); border-radius:12px; padding:.75rem .95rem;
      outline:none; transition:border-color .2s ease, box-shadow .2s ease; font-size:1rem;
    }
    input:focus, select:focus, textarea:focus{border-color:rgba(167,139,250,.55); box-shadow:0 0 0 3px rgba(167,139,250,.18)}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row .col{flex:1 1 160px}

    .actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .right{margin-left:auto}

    /* Tabs */
    .tabs{display:flex; gap:8px; margin:6px 0 12px}
    .tab{
      padding:.45rem .7rem; border:1px solid var(--border); border-radius:999px;
      background:#0c1226; color:var(--muted); cursor:pointer; font-weight:600;
      transition: border-color .2s ease, background .2s ease, color .2s ease;
    }
    .tab[aria-selected="true"]{
      color:#06131a; border-color:transparent;
      background:linear-gradient(135deg, var(--brand-1), var(--brand-2));
    }

    /* Output area (consistent measure; soft scroll) */
    .out-wrap{
      border:1px solid var(--border);
      border-radius:14px; background:#0b1028;
      padding:16px; max-height:60vh; overflow:auto;
    }
    pre{
      margin:0; white-space:pre-wrap; word-wrap:break-word;
      font-size:.96rem; line-height:1.6; max-width:72ch;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    }

    .footer{
      color:var(--muted); border-top:1px solid var(--border); padding:18px 0; margin:30px 0 16px;
      text-align:center; font-size:.9rem
    }
  </style>
</head>
<body>
  <!-- Header (unchanged nav) -->
  <header>
    <div class="container nav">
      <a class="brand" href="/" aria-label="MentalHealthContent.ai home">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <defs><linearGradient id="g" x1="0" y1="0" x2="24" y2="24"><stop stop-color="#8b5cf6"/><stop offset="1" stop-color="#22d3ee"/></linearGradient></defs>
          <path d="M12 21s-6-3.8-9-7.1C1 12 1 9.5 2.7 7.8 4.3 6.1 7 6 8.7 7.6l.8.8.8-.8C12 6 14.7 6.1 16.3 7.8 18 9.5 18 12 17 13.9 14 17.2 12 21 12 21z" fill="url(#g)"/>
        </svg>
        <span>MentalHealthContent.ai</span>
      </a>
      <nav class="menu" aria-label="Primary">
        <a class="btn ghost" href="/#examples">Examples</a>
        <a class="btn ghost" href="/#prompts">Free Prompts</a>
        <a class="btn ghost" href="/#pricing">Pricing</a>
        <a class="btn ghost" href="/#faq">FAQ</a>
        <a class="btn ghost" href="https://app.mentalhealthcontent.ai" rel="noopener">Sign in</a>
        <a class="btn primary" href="/#start">Start free</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="container">
      <div class="row" style="align-items:center; gap:12px">
        <span class="chip">Beta</span>
        <a class="pill" href="/#prompts">Try 3 free prompts</a>
        <span class="small">No PHI • HIPAA-conscious workflows • Reading-level & tone controls</span>
      </div>
      <h1>Generate client-friendly content</h1>
      <p class="small">Start with a topic and format. Choose Text or export a DOCX. Educational use only.</p>
    </div>
  </section>

  <!-- Studio layout -->
  <main class="container studio">
    <!-- Rail: inputs -->
    <section class="rail">
      <h3 style="margin-top:0">Your request</h3>
      <form id="genForm">
        <label for="topic">Topic</label>
        <input id="topic" name="topic" placeholder="5-4-3-2-1 grounding for teens" value="DBT Skills for Teens" />

        <div style="height:10px"></div>
        <div class="row">
          <div class="col">
            <label for="format">Format</label>
            <select id="format" name="format">
              <option value="carousel">Instagram carousel</option>
              <option value="worksheet" selected>Worksheet outline</option>
              <option value="video">60s video script</option>
              <option value="blog">Blog outline</option>
            </select>
          </div>
        </div>

        <div style="height:12px"></div>
        <div class="actions">
          <button class="btn primary" type="submit" id="btnGenerate">Generate</button>
          <button class="btn ghost" type="button" id="btnSample">Use sample</button>
          <span class="small right mono" id="status"></span>
        </div>

        <div style="height:8px"></div>
        <p class="small mono">Calls <code>POST /api/generate</code> with <code>{topic, format}</code>.</p>
      </form>

      <hr style="border:none;border-top:1px solid var(--border); margin:16px 0">
      <p class="small" style="margin:0">Tip: Keep topics concrete (e.g., “CARL technique for active listening – teen group”).</p>
    </section>

    <!-- Canvas: results -->
    <section class="canvas" aria-live="polite">
      <div class="tabs" role="tablist" aria-label="Output type">
        <button class="tab" role="tab" id="tab-text" aria-selected="true" aria-controls="panel-text">Text</button>
        <button class="tab" role="tab" id="tab-docx" aria-selected="false" aria-controls="panel-docx">Document</button>
      </div>

      <!-- TEXT PANEL -->
      <section id="panel-text" role="tabpanel" aria-labelledby="tab-text">
        <h3 style="margin-top:0">Output</h3>
        <div class="out-wrap">
          <pre id="out">Run a generation to see output…</pre>
        </div>
        <div class="actions" style="margin-top:10px">
          <button class="btn ghost" type="button" id="btnCopy" disabled>Copy output</button>
        </div>
      </section>

      <!-- DOCX PANEL -->
      <section id="panel-docx" role="tabpanel" aria-labelledby="tab-docx" hidden>
        <h3 style="margin-top:0">Document</h3>
        <p class="small">Generate content, then export as a Word document (.docx) with one click.</p>
        <div class="actions" style="margin-top:6px">
          <button class="btn primary" type="button" id="btnGenerateDoc">Generate & Download DOCX</button>
        </div>
        <div class="out-wrap" style="margin-top:12px">
          <pre id="docPreview">Document preview will appear here…</pre>
        </div>
      </section>
    </section>
  </main>

  <div class="container footer">
    Educational use only. Not for clinical diagnosis or crisis use. © 2025
  </div>

  <script>
    // Elements
    const form = document.getElementById('genForm');
    const topic = document.getElementById('topic');
    const formatSel = document.getElementById('format');
    const statusEl = document.getElementById('status');
    const out = document.getElementById('out');
    const copyBtn = document.getElementById('btnCopy');
    const sampleBtn = document.getElementById('btnSample');
    const genBtn = document.getElementById('btnGenerate');

    const tabText = document.getElementById('tab-text');
    const tabDocx = document.getElementById('tab-docx');
    const panelText = document.getElementById('panel-text');
    const panelDocx = document.getElementById('panel-docx');
    const genDocBtn = document.getElementById('btnGenerateDoc');
    const docPreview = document.getElementById('docPreview');

    // Tabs
    function selectTab(which){
      const isText = which === 'text';
      tabText.setAttribute('aria-selected', isText ? 'true' : 'false');
      tabDocx.setAttribute('aria-selected', isText ? 'false' : 'true');
      panelText.hidden = !isText;
      panelDocx.hidden = isText;
    }
    tabText.addEventListener('click', () => selectTab('text'));
    tabDocx.addEventListener('click', () => selectTab('docx'));

    // Helpers
    function setStatus(msg){ statusEl.textContent = msg || ''; }
    function setOut(text){
      out.textContent = text || '';
      copyBtn.disabled = !out.textContent.trim();
    }

    sampleBtn.addEventListener('click', () => {
      topic.value = "5-4-3-2-1 grounding for teens";
      formatSel.value = "carousel";
      topic.focus();
    });

    copyBtn.addEventListener('click', async () => {
      try{
        await navigator.clipboard.writeText(out.textContent || "");
        copyBtn.textContent = "Copied!";
        setTimeout(() => copyBtn.textContent = "Copy output", 1200);
      }catch(e){
        copyBtn.textContent = "Copy failed";
        setTimeout(() => copyBtn.textContent = "Copy output", 1200);
      }
    });

    async function runGeneration(payload){
      setStatus("Generating…");
      setOut("");
      try{
        const res = await fetch('/api/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if(!res.ok){
          const txt = await res.text();
          setOut(`Error ${res.status}: ${txt || 'Request failed'}`);
          return null;
        }
        const data = await res.json();
        const text = data.output || data.error || data.debug || '';
        setOut(text || 'No output');
        return text || '';
      }catch(err){
        setOut('Fetch error: ' + err.message);
        return null;
      }finally{
        setStatus("");
      }
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = { topic: topic.value?.trim(), format: formatSel.value };
      if(!payload.topic){ topic.focus(); return; }
      await runGeneration(payload);
    });

    // DOCX generation
    genDocBtn.addEventListener('click', async () => {
      const payload = { topic: topic.value?.trim(), format: formatSel.value };
      if(!payload.topic){ topic.focus(); return; }

      // Run generation (reuse API)
      const text = await runGeneration(payload);
      if(!text) return;

      // Show preview
      docPreview.textContent = text;

      // Build .docx
      try{
        const { Document, Packer, Paragraph, HeadingLevel, TextRun } = window.docx;

        // Convert lines to paragraphs; simple heading heuristic
        const lines = text.split(/\r?\n/);
        const children = [];
        for(const line of lines){
          if(!line.trim()){ children.push(new Paragraph("")); continue; }
          const isH3 = line.trim().startsWith("### ");
          const content = isH3 ? line.replace(/^###\s+/, "") : line;
          children.push(
            isH3
              ? new Paragraph({ text: content, heading: HeadingLevel.HEADING_3 })
              : new Paragraph({ children: [ new TextRun({ text: content }) ] })
          );
        }

        const doc = new Document({
          sections: [{ properties: {}, children }]
        });

        const blob = await Packer.toBlob(doc);
        const fname = `MHC_${(payload.topic || 'document').replace(/[^a-z0-9]+/gi,'_')}.docx`;
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = fname;
        document.body.appendChild(a);
        a.click();
        URL.revokeObjectURL(a.href);
        a.remove();
      }catch(err){
        alert("DOCX build failed: " + err.message);
      }
    });
  </script>
</body>
</html>

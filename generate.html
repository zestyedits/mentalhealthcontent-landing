<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Generate — MentalHealthContent.ai</title>
  <meta name="description" content="Generate audience-friendly mental-health content with AI. Export text or DOCX." />
  <style>
    :root { --bg:#0b1022; --panel:#0e1436; --muted:#c7d2fe; --text:#eef2ff; --accent:#8b5cf6; --accent-2:#06b6d4; --card:#0a0f2b; --border:#1b2161; --ring:rgba(139,92,246,.35) }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,"Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji";color:var(--text);line-height:1.5;background:radial-gradient(1000px 600px at 10% -10%,color-mix(in oklab,var(--accent) 40%,transparent),transparent 60%),radial-gradient(900px 500px at 90% 10%,color-mix(in oklab,var(--accent-2) 40%,transparent),transparent 60%),linear-gradient(180deg,var(--bg),#0b0f24 50%,var(--panel) 120%)}
    a{color:var(--accent-2);text-decoration:none} a:hover{text-decoration:underline}
    .container{width:100%;max-width:1100px;margin:0 auto;padding:0 1rem}
    header{position:sticky;top:0;z-index:50;backdrop-filter:saturate(140%) blur(8px);background:rgba(11,18,32,.7);border-bottom:1px solid var(--border)}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:.9rem 0}
    .brand{display:flex;align-items:center;gap:.6rem;font-weight:700;letter-spacing:.2px}
    .brand svg{width:28px;height:28px}
    .menu{display:flex;gap:1rem;align-items:center}
    .menu a{color:var(--text);opacity:.9;font-size:.95rem}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;border:1px solid var(--border);background:#101826;color:var(--text);padding:.65rem .95rem;border-radius:.75rem;font-weight:600;cursor:pointer;transition:transform .04s ease,box-shadow .2s ease}
    .btn:hover{transform:translateY(-1px);box-shadow:0 6px 16px rgba(0,0,0,.25)}
    .btn.primary{background:linear-gradient(135deg,var(--accent),var(--accent-2));border-color:transparent;color:#0a0a0a;box-shadow:0 0 0 2px var(--ring),0 8px 24px rgba(0,0,0,.35)}
    .btn.primary:hover{transform:translateY(-2px) scale(1.01)}
    .btn.ghost{background:transparent}
    .hero{padding:2.75rem 0 1.25rem}
    .hero h1{font-size:clamp(1.9rem,2.4vw + 1rem,2.8rem);line-height:1.12;margin:.25rem 0 .5rem;background:linear-gradient(90deg,var(--accent),var(--accent-2));-webkit-background-clip:text;background-clip:text;color:transparent}
    .meta{color:var(--muted);font-size:.95rem}
    .pill{display:inline-block;font-size:.75rem;letter-spacing:.2px;border:1px solid transparent;color:#0a0a0a;padding:.32rem .6rem;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent-2))}
    .card{background:linear-gradient(180deg,rgba(167,139,250,.08),rgba(34,211,238,.06)),var(--card);border:1px solid var(--border);border-radius:1rem;padding:1rem;transition:transform .15s ease,box-shadow .2s ease,border-color .2s ease}
    .card:hover{transform:translateY(-2px);border-color:color-mix(in hsl,var(--accent) 30%,var(--border));box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .studio{display:grid;gap:1rem;margin:1rem 0 2rem;align-items:start}
    @media(min-width:980px){.studio{grid-template-columns:390px minmax(0,1fr)}}
    .rail h3,.canvas h3{margin:.2rem 0 .6rem;font-size:1.05rem}
    label{display:block;font-weight:600;margin:.4rem 0 .35rem}
    input,select{width:100%;background:#0c1424;color:var(--text);border:1px solid var(--border);border-radius:.7rem;padding:.7rem .85rem;outline:none;transition:border-color .2s ease,box-shadow .2s ease;font-size:1rem}
    input:focus,select:focus{border-color:#5b7fff;box-shadow:0 0 0 3px color-mix(in oklab,var(--accent) 25%,transparent)}
    .actions{display:flex;gap:.6rem;flex-wrap:wrap;align-items:center}
    .right{margin-left:auto;color:var(--muted);font-size:.9rem}
    .out{border:1px solid var(--border);background:#0c1424;border-radius:.7rem;padding:.9rem;max-height:60vh;overflow:auto}
    pre{margin:0;white-space:pre-wrap;word-wrap:break-word;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace;font-size:.95rem;line-height:1.6;max-width:72ch}
    footer{border-top:1px solid var(--border);padding:2rem 0;color:var(--muted);font-size:.9rem;margin-top:.5rem}
    html{scroll-behavior:smooth}.page-enter{opacity:0}.page-enter-active{opacity:1;transition:opacity .28s ease}.page-exit{opacity:1}.page-exit-active{opacity:0;transition:opacity .22s ease}
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.3.2/docx.umd.min.js" defer></script>
</head>
<body>
  <header>
    <div class="container nav">
      <a data-xnav class="brand" href="index.html" aria-label="MentalHealthContent.ai home">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 21s-6-3.8-9-7.1C1 12 1 9.5 2.7 7.8c1.6-1.6 4.3-1.5 6 0L12 9l3.3-1.2c1.7-1.5 4.4-1.6 6 0C22 9.5 22 12 21 13.9 18 17.2 12 21 12 21z" fill="url(#g)"/></svg>
        <span>MentalHealthContent.ai</span>
      </a>
      <nav class="menu" aria-label="primary">
        <a data-xnav href="index.html#examples">Examples</a>
        <a data-xnav href="index.html#prompts">Free Prompts</a>
        <a data-xnav href="index.html#pricing">Pricing</a>
        <a data-xnav href="index.html#faq">FAQ</a>
        <a data-xnav class="btn ghost" href="login.html">Sign in</a>
        <a data-xnav class="btn primary" href="generate.html?trial=1">Try generator</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <h1>Generate audience-friendly content</h1>
      <p class="meta">
        Great for clinicians, coaches, educators, creators, and teams. Start with a topic and format; get a clean draft you can tune for your audience. Export text or DOCX.
        <em> Educational use only.</em>
        <span id="creditPill" class="pill" style="margin-left:.5rem">Free credits left: 2</span>
      </p>
    </section>

    <section class="studio">
      <div class="card rail">
        <h3>Your request</h3>
        <form id="genForm">
          <label for="topic">Topic</label>
          <input id="topic" name="topic" placeholder="5-4-3-2-1 grounding for teens" value="DBT Skills for Teens" />
          <label for="format" style="margin-top:.7rem;">Format</label>
          <select id="format" name="format">
            <option value="carousel">Instagram carousel</option>
            <option value="worksheet" selected>Worksheet outline</option>
            <option value="video">60s video script</option>
            <option value="blog">Blog outline</option>
          </select>
          <div class="actions" style="margin-top:.8rem">
            <button class="btn primary" type="submit" id="btnGenerate">Generate</button>
            <button class="btn" type="button" id="btnSample">Use sample</button>
            <span class="right" id="status"></span>
          </div>
        </form>

        <hr style="border:none;border-top:1px solid var(--border); margin:1rem 0">
        <div class="actions" style="gap:.5rem">
          <button class="btn" id="btnDocx" title="Sign in to export DOCX" disabled>Generate & Download DOCX</button>
          <button class="btn" id="btnCopy" disabled>Copy output</button>
        </div>
        <p class="micro" style="margin-top:.6rem">No account needed for your first 2 generations. Sign in to save and export.</p>
      </div>

      <div class="card canvas" aria-live="polite">
        <h3>Output</h3>
        <div class="out"><pre id="out">Run a generation to see output…</pre></div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container"><div>MentalHealthContent.ai • © <span id="yr"></span></div></div>
  </footer>

  <script>
    // transitions
    document.documentElement.classList.add('page-enter');
    requestAnimationFrame(()=>{document.documentElement.classList.add('page-enter-active');document.documentElement.classList.remove('page-enter')});
    document.addEventListener('click',(e)=>{const a=e.target.closest('a[data-xnav]');if(!a)return;const sameTab=!a.target||a.target==='_self';if(!sameTab)return;e.preventDefault();document.documentElement.classList.add('page-exit');requestAnimationFrame(()=>{document.documentElement.classList.add('page-exit-active');setTimeout(()=>{location.href=a.getAttribute('href')},180)})});
    document.getElementById('yr').textContent=new Date().getFullYear();

    // trial credits
    const TRIAL_KEY='mhc_trial_uses_v1',MAX_FREE=2,creditPill=document.getElementById('creditPill');
    function getTrialUses(){return Number(localStorage.getItem(TRIAL_KEY)||0)} function incTrialUses(){localStorage.setItem(TRIAL_KEY,String(getTrialUses()+1))} function remainingFree(){return Math.max(0,MAX_FREE-getTrialUses())} function updateCreditPill(){if(creditPill) creditPill.textContent=`Free credits left: ${remainingFree()}`}
    updateCreditPill(); (function(){const url=new URL(location.href);if(url.searchParams.get('trial')==='1') document.getElementById('topic').focus()})();

    // elements
    const form=document.getElementById('genForm'),topic=document.getElementById('topic'),formatSel=document.getElementById('format'),statusEl=document.getElementById('status'),out=document.getElementById('out'),copyBtn=document.getElementById('btnCopy'),sampleBtn=document.getElementById('btnSample'),genBtn=document.getElementById('btnGenerate'),docxBtn=document.getElementById('btnDocx');
    function setStatus(m){statusEl.textContent=m||''} function setOut(t){out.textContent=t||'';copyBtn.disabled=!out.textContent.trim()}
    function enforceTrialGate(){if(remainingFree()===0){genBtn.disabled=true;genBtn.textContent='Create a free account to keep going';genBtn.onclick=()=>location.href='login.html'}}
    enforceTrialGate();

    sampleBtn.addEventListener('click',()=>{topic.value="5-4-3-2-1 grounding for teens";formatSel.value="carousel";topic.focus()});
    copyBtn.addEventListener('click',async()=>{try{await navigator.clipboard.writeText(out.textContent||"");const old=copyBtn.textContent;copyBtn.textContent="Copied!";setTimeout(()=>copyBtn.textContent=old,900)}catch(e){}});

    async function runGeneration(payload){
      if(remainingFree()===0){enforceTrialGate();return null}
      setStatus("Generating…"); setOut("");
      try{
        const res=await fetch('/api/generate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
        if(!res.ok){const txt=await res.text();setOut(`Error ${res.status}: ${txt||'Request failed'}`);return null}
        const data=await res.json(); const text=data.output||data.error||data.debug||''; setOut(text||'No output');
        if(text){incTrialUses();updateCreditPill();enforceTrialGate()}
        return text||'';
      }catch(err){setOut('Fetch error: '+err.message);return null} finally{setStatus("")}
    }

    form.addEventListener('submit',async(e)=>{e.preventDefault();const payload={topic:topic.value?.trim(),format:formatSel.value};if(!payload.topic){topic.focus();return}await runGeneration(payload)});

    // DOCX remains gated to login
    docxBtn.addEventListener('click',()=>{alert('Sign in to export DOCX.');location.href='login.html'});
  </script>
</body>
</html>
